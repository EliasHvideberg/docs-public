"use strict";(self.webpackChunksaga_docs=self.webpackChunksaga_docs||[]).push([[158],{3905:function(e,t,r){r.d(t,{Zo:function(){return g},kt:function(){return p}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),d=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},g=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,g=i(e,["components","mdxType","originalType","parentName"]),k=d(r),p=a,m=k["".concat(s,".").concat(p)]||k[p]||u[p]||o;return r?n.createElement(m,l(l({ref:t},g),{},{components:r})):n.createElement(m,l({ref:t},g))}));function p(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=k;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var d=2;d<o;d++)l[d]=r[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}k.displayName="MDXCreateElement"},2961:function(e,t,r){r.r(t),r.d(t,{assets:function(){return g},contentTitle:function(){return s},default:function(){return p},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return u}});var n=r(7462),a=r(3366),o=(r(7294),r(3905)),l=["components"],i={},s="Analyse i BigQuery",d={unversionedId:"bigquery/README",id:"bigquery/README",title:"Analyse i BigQuery",description:"BigQuery er GCP sin SQL-kompatible database/datavarehus for effektiv analyse, selv n\xe5r datamengdene blir store. Du jobber typisk i BigQuery Console, men det er ogs\xe5 mulig \xe5 gj\xf8re sp\xf8rringer b\xe5de fra komdudolinjen med bq-klienten, eller fra f.eks. Jupyter Notebook.",source:"@site/docs/03-bigquery/README.md",sourceDirName:"03-bigquery",slug:"/bigquery/",permalink:"/docs-public/bigquery/",editUrl:"https://github.com/svvsaga/docs-public/edit/main/docs/03-bigquery/README.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Kom i gang",permalink:"/docs-public/google-cloud-platform/kom-i-gang"},next:{title:"Laste ned datasett og resultater",permalink:"/docs-public/bigquery/laste-ned-datasett"}},g={},u=[{value:"N\xe5r b\xf8r du bruke BigQuery?",id:"n\xe5r-b\xf8r-du-bruke-bigquery",level:2},{value:"M\xe5ter \xe5 bruke BigQuery p\xe5",id:"m\xe5ter-\xe5-bruke-bigquery-p\xe5",level:2},{value:"Koble seg opp til BigQuery fra egen maskin",id:"koble-seg-opp-til-bigquery-fra-egen-maskin",level:2},{value:"Laste opp egne datasett",id:"laste-opp-egne-datasett",level:2},{value:"Laste ned datasett og resultater",id:"laste-ned-datasett-og-resultater",level:2}],k={toc:u};function p(e){var t=e.components,r=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,n.Z)({},k,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"analyse-i-bigquery"},"Analyse i BigQuery"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery"},"BigQuery")," er GCP sin SQL-kompatible database/datavarehus for effektiv analyse, selv n\xe5r datamengdene blir store. Du jobber typisk i ",(0,o.kt)("a",{parentName:"p",href:"https://console.cloud.google.com/bigquery"},"BigQuery Console"),", men det er ogs\xe5 mulig \xe5 gj\xf8re sp\xf8rringer b\xe5de fra komdudolinjen med ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/quickstarts/load-data-bq"},"bq-klienten"),", eller fra f.eks. ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/visualize-jupyter"},"Jupyter Notebook"),"."),(0,o.kt)("h2",{id:"n\xe5r-b\xf8r-du-bruke-bigquery"},"N\xe5r b\xf8r du bruke BigQuery?"),(0,o.kt)("p",null,"BigQuery er et godt valg n\xe5r du \xf8nsker \xe5:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Kj\xf8re analyser p\xe5 st\xf8rre mengder strukturerte data."),"\nBigQuery lar deg gj\xf8re sp\xf8rringer p\xe5 petabytes med data. Prosesseringstiden er i stor grad begrenset av effektiviteten til sp\xf8rringene du skriver heller enn tiden det tar \xe5 kverne gjennom store mengder data. Det som er viktig \xe5 v\xe6re klar over er at ",(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("em",{parentName:"strong"},"man betaler for mengden data som prosesseres")),", og ikke kj\xf8retid eller ressursbruk som kanskje hadde v\xe6rt \xe5 forvente.")),(0,o.kt)("p",null,"Databasen er ",(0,o.kt)("em",{parentName:"p"},"kolonnebasert"),", noe som betyr at det er veldig mye \xe5 spare p\xe5 \xe5 utelate kolonner du ikke har bruk for fra sp\xf8rringer, f.eks. store geografikolonner, og ikke alltid direkte g\xe5 for ",(0,o.kt)("inlineCode",{parentName:"p"},"SELECT *"),". Dette er fordi data for hver kolonne ligger lagret sammen, heller enn rad for rad slik som man kanskje er vant med fra tradisjonelle SQL databaser. Det betyr ogs\xe5 at kolonnen i sin helhet m\xe5 hentes om den sp\xf8rres p\xe5, med mindre ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/clustered-tables"},"clustering")," eller ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/partitioned-tables"},"partisjonering")," er i bruk."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Sammenstille ulike datasett."),"\nSelv om BigQuery ikke st\xf8tter prim\xe6r- og fremmedn\xf8kler slik som tradisjonelle SQL-databaser gj\xf8r, egner den seg godt for rask sammenstilling av data fra forskjellige kilder, ogs\xe5 for store mengder data. Dette kan gj\xf8res ved \xe5 bruke ",(0,o.kt)("inlineCode",{parentName:"li"},"join")," p\xe5 verdier, f.eks. tidspunkt, for \xe5 sammenligne data p\xe5 tvers av tabeller. Her m\xe5 man v\xe6re spesielt oppmerksom p\xe5 om felter i datagrunnlaget kan endre innhold over tid, selv om de representerer det samme."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Dele strukturert data."),"\nBigQuery egner seg veldig godt til deling av strukturert og veldokumentert data, p\xe5 et velkjent format, som er enkelt \xe5 konsumere for andre mottakere. Ved \xe5 ha fokus p\xe5 \xe5 benytte de innebygde datatypene der det gir mening, som f.eks. ",(0,o.kt)("inlineCode",{parentName:"li"},"TIMESTAMP"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"DATE")," og ",(0,o.kt)("inlineCode",{parentName:"li"},"GEOGRAPHY"),", lettes bruk og sammenstilling av data betraktelig for andre konsumenter."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Benytte SQL-kompetanse."),"\nFor \xe5 sp\xf8rre ut data fra tabeller og views i BigQuery benytter man Standard SQL. Her er eksisterende SQL-kompetanse i stor grad overf\xf8rbar, i tillegg til ekstra funksjonalitet som tilbys, f.eks. for GIS-operasjoner p\xe5 geografiske data. Databasen har ogs\xe5 klientbiblioteker i duge spr\xe5k for de som \xf8nsker \xe5 skrive applikasjoner som aksesserer data: Python, Java, Go, C#, PHP, Ruby, and Node.js."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Tilgang p\xe5 avanserte analytiske funksjoner."),"\nDatabasen har god st\xf8tte for avanserte analytiske funksjoner som kan v\xe6re nyttige i analyser av data, som f.eks. ",(0,o.kt)("inlineCode",{parentName:"li"},"GROUP BY")," , ",(0,o.kt)("inlineCode",{parentName:"li"},"SUM()"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"ARRAY_AGG()"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"PARTITION BY")," , ",(0,o.kt)("inlineCode",{parentName:"li"},"LEAD()"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"LAG()")," , ",(0,o.kt)("inlineCode",{parentName:"li"},"FIRST_VALUE()"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"LAST_VALUE()")," og ",(0,o.kt)("inlineCode",{parentName:"li"},"ANY_VALUE()")," for \xe5 nevne noen.\nSe ogs\xe5 ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/reference/standard-sql/aggregate_analytic_functions"},"oversikten over tillgjengelige funksjoner")," og ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/reference/standard-sql/analytic-function-concepts"},"Googles egen forklaring av analytiske konsepter"),".")),(0,o.kt)("p",null,"Noen ting BigQuery -ikke- kan/b\xf8r brukes til er:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Ustrukturert data - bruk heller GCS eller Datastore."),"\nFor ustrukturerte data som \xf8nskes lagret p\xe5 fil er GCS \xe5 foretrekke, mens Datastore er et godt alternativ som dokumentlager (NOSQL).\nSelv om det er mulig \xe5 mate ustrukturerte data som JSON inn i BigQuery og sp\xf8rre p\xe5 de, vil vi anbefale \xe5 benytte strukturerte data i den grad det er mulig. Dette fordi dypt n\xf8stede JSON-strukturer i duge tilfeller krever un\xf8dvendig mye innsats for \xe5 f\xe5 spurt ut riktig, med kombinasjon av kryssing av eksisterende rader og bruk av ",(0,o.kt)("inlineCode",{parentName:"li"},"UNNEST()")," som ikke n\xf8dvendigvis er intuitivt for nye brukere."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Transaksjonell/operasjonell data - bruk heller PostgreSQL."),"\nSt\xf8tten for transaksjoner i databasen har inntil nylig v\xe6rt veldig begrenset. Det foreg\xe5r derimot til stadighet forbedringer som kontinuerlig rulles ut, b\xe5de mtp featuresett og tilgjengelige SQL-operasjoner. Tidlig i April 2022 er ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting#transactions"},"BigQuery-st\xf8tten for transaksjoner i \u201cpre-GA\u201d"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Relasjonelle data og data som trenger indekser - bruk heller PostgreSQL."),"\nBigquery st\xf8tter ikke prim\xe6r- og fremmedn\xf8kler og de garantier de kan gi, ei heller indekser for raskere s\xf8k og oppslag. Om dette er funksjonalitet du har bruk for vil vi heller anbefale PostgreSQL eller lignende.\nDerimot er st\xf8tten for sammenstilling av store mengder data fortsatt god, feks ved bruk av ",(0,o.kt)("inlineCode",{parentName:"li"},"join"),". Tabeller i BigQuery kan ogs\xe5 b\xe5de ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/clustered-tables"},"clustres")," og ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/partitioned-tables"},"partisjoneres"),", som kan bidra til \xe5 \xf8ke ytelsen p\xe5 sp\xf8rringer og f\xf8re til besparelser ved at de underliggende data samlokaliseres."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Caching - bruk heller Memorystore og/eller Redis."),"\nDirekteoppslag p\xe5 enkeltrader er ikke noe BigQuery er spesielt godt egnet til. Her finnes det mye bedre valg i andre teknologier, som f.eks. Memorystore og/eller Redis.\nBigQuery-databasen i sin ",(0,o.kt)("em",{parentName:"li"},"kolonnebaserte")," natur gj\xf8r at alle oppslag du gj\xf8r mot en kolonne vil m\xe5tte hente alle data for den valgte kolonnen (med mindre clustering eller partisjonering er i spill), selv om sp\xf8rringen f.eks. har en ",(0,o.kt)("inlineCode",{parentName:"li"},"WHERE"),"-clause eller andre mekanismer for filtrering av enkeltrader."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Hurtig endrende sanntidsdata - bruk heller PostgreSQL eller Datastore."),"\nBigQuery har to m\xe5ter \xe5 laste inn data p\xe5: batch jobs og streaming. Batch jobs passer for engangs eller periodisk innlasting av store datasett, mens streaming kan brukes for sanntidsdata. P\xe5 grunn av databasens h\xf8ye skriveytelse ved streaming av sanntidsdata har den begrensninger n\xe5r det kommer til \xe5 operere p\xe5 data som nylig er satt inn p\xe5 denne m\xe5ten. Du kan ikke umiddelbart endre eller slette rader som streames inn til BigQuery. Har du slike behov er det derfor bedre \xe5 vurdere PostgreSQL eller Datastore.")),(0,o.kt)("p",null,"Se ogs\xe5 ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/introduction"},"Googles introduksjon til BigQuery"),"."),(0,o.kt)("h2",{id:"m\xe5ter-\xe5-bruke-bigquery-p\xe5"},"M\xe5ter \xe5 bruke BigQuery p\xe5"),(0,o.kt)("p",null,"Du kan bruke BigQuery fra:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/bigquery"},"Google Cloud Console")),(0,o.kt)("li",{parentName:"ul"},"Egen maskin (via ",(0,o.kt)("inlineCode",{parentName:"li"},"bq")," eller et SQL-verkt\xf8y)"),(0,o.kt)("li",{parentName:"ul"},"Jupyter Notebooks, f.eks. i ",(0,o.kt)("a",{parentName:"li",href:"https://colab.research.google.com/"},"Google Colab"))),(0,o.kt)("h2",{id:"koble-seg-opp-til-bigquery-fra-egen-maskin"},"Koble seg opp til BigQuery fra egen maskin"),(0,o.kt)("p",null,"For \xe5 kalle BigQuery fra egen maskin m\xe5 du ha satt opp autentisering. Den enkleste m\xe5ten \xe5 gj\xf8re dette p\xe5 er \xe5 bruke ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/sdk/docs/install"},"Google Cloud CLI (gcloud)"),"."),(0,o.kt)("p",null,"N\xe5r du har fulgt installasjonsveilederen i linken over, kan du kj\xf8re f\xf8lgende:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud auth login\ngcloud auth application-default login\n")),(0,o.kt)("p",null,"For hver av disse vil du f\xe5 opp en nettside der du m\xe5 godkjenne innlogging med din ",(0,o.kt)("inlineCode",{parentName:"p"},"<fornavn.etternavn>@vegvesen.no"),"-bruker."),(0,o.kt)("p",null,"F\xf8r du kan begynne \xe5 gj\xf8re sp\xf8rringer b\xf8r du sette opp default project og default quota project (sett inn IDen til ditt prosjekt):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud config set project saga-olanor-playground-1234\ngcloud auth application-default set-quota-project saga-olanor-playground-1234\n")),(0,o.kt)("h2",{id:"laste-opp-egne-datasett"},"Laste opp egne datasett"),(0,o.kt)("p",null,"Hvis du har egne datasett liggende i CSV eller JSON-format og \xf8nsker \xe5 bruke disse til analyse i BigQuery kan du f\xf8lge Googles guide for ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/loading-data-cloud-storage-csv#loading_csv_data_into_a_table"},"CSV"),", ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/loading-data-cloud-storage-json#loading_json_data_into_a_new_table"},"JSON")," og duge andre formater."),(0,o.kt)("h2",{id:"laste-ned-datasett-og-resultater"},"Laste ned datasett og resultater"),(0,o.kt)("p",null,"Du kan enkelt laste ned datasett og resultatet fra BigQuery Cloud Console. ",(0,o.kt)("a",{parentName:"p",href:"bigquery/laste-ned-datasett"},"Se denne siden for et eksempel.")))}p.isMDXComponent=!0}}]);