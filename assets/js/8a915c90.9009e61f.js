"use strict";(self.webpackChunksaga_docs=self.webpackChunksaga_docs||[]).push([[102],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,g=u["".concat(o,".").concat(m)]||u[m]||k[m]||i;return a?n.createElement(g,l(l({ref:t},d),{},{components:a})):n.createElement(g,l({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},7140:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>k,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={},l="Hvordan f\xe5 data inn i Saga",s={unversionedId:"utvikling-paa-saga/hvordan-faa-data-inn-i-saga",id:"utvikling-paa-saga/hvordan-faa-data-inn-i-saga",title:"Hvordan f\xe5 data inn i Saga",description:"Mange datasett er allerede tilgjengelige i datakatalogen v\xe5r, men ofte vil man ha behov for \xe5 hente inn nye datakilder.",source:"@site/docs/03-utvikling-paa-saga/04-hvordan-faa-data-inn-i-saga.md",sourceDirName:"03-utvikling-paa-saga",slug:"/utvikling-paa-saga/hvordan-faa-data-inn-i-saga",permalink:"/docs-public/utvikling-paa-saga/hvordan-faa-data-inn-i-saga",draft:!1,editUrl:"https://github.com/svvsaga/docs-public/edit/main/docs/03-utvikling-paa-saga/04-hvordan-faa-data-inn-i-saga.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Kostnader og budsjett",permalink:"/docs-public/utvikling-paa-saga/kostnader-og-budsjett"},next:{title:"Terraform",permalink:"/docs-public/utvikling-paa-saga/terraform"}},o={},p=[{value:"Pipeline-arkitekturer",id:"pipeline-arkitekturer",level:2},{value:"Pull-pipelines",id:"pull-pipelines",level:3},{value:"Eksempel",id:"eksempel",level:4},{value:"Push-pipelines",id:"push-pipelines",level:3},{value:"Eksempel",id:"eksempel-1",level:4}],d={toc:p};function k(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"hvordan-f\xe5-data-inn-i-saga"},"Hvordan f\xe5 data inn i Saga"),(0,r.kt)("p",null,"Mange datasett er allerede tilgjengelige i ",(0,r.kt)("a",{parentName:"p",href:"https://data.saga.vegvesen.no/"},"datakatalogen v\xe5r"),", men ofte vil man ha behov for \xe5 hente inn nye datakilder."),(0,r.kt)("p",null,"N\xe5r data skal deles i datakatalogen, eller benyttes som del av et foredlet dataprodukt, b\xf8r man lage en ",(0,r.kt)("em",{parentName:"p"},"automatisk ingest-pipeline"),". For at denne skal kunne bygges og vedlikeholdes p\xe5 en robust og effektiv m\xe5te, er det en del prinsipper som b\xf8r f\xf8lges:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Gjenproduserbar infrastruktur")," \u2013 Alle ressurser som benyttes i GCP b\xf8r provisjoneres p\xe5 en reproduserbar og versjonert metode, slik at man kan v\xe6re sikker p\xe5 at samme infrastruktur kj\xf8rer i ulike milj\xf8er, samt kunne sette opp infrastruktur p\xe5 nytt dersom det skulle v\xe6re n\xf8dvendig. I praksis betyr dette at ressurser defineres i Terraform, sjekkes inn i kode og deployes via CI/CD (for eksempel GitHub Actions).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Keep it simple")," - Lag den enkleste arkitekturen som oppfyller kravene til ingest. I mange tilfeller betyr dette en eller flere Cloud Functions, men kan ogs\xe5 v\xe6re enkle ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/scheduling-queries"},"scheduled queries"),", eller data-verkt\xf8y som ",(0,r.kt)("a",{parentName:"p",href:"https://www.getdbt.com/"},"DBT"),". I mer avanserte scenarier kan orkestreringstjenester som ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/dataflow"},"Dataflow")," v\xe6re n\xf8dvendig, men b\xf8r ikke v\xe6re f\xf8rstevalg for enhver l\xf8sning, p\xe5 grunn av \xf8kt kompleksitet og kostnad.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Idempotens og deduplisering"),' - I GCP kan det skje at functions feiler og blir "retryet"; det er derfor viktig at enhver pipeline er laget slik at gjentatte kj\xf8ringer ikke f\xf8rer til inkonsistente data. For eksempel kan man ha ulike BigQuery-tabeller for "landing" og visning av data, der den f\xf8rstnevnte kan inneholde duplikater, mens den endelige tabellen kun viser deduplisert data, for eksempel ved \xe5 definere et view, eller en merge query fra landings-tabellen.'))),(0,r.kt)("h2",{id:"pipeline-arkitekturer"},"Pipeline-arkitekturer"),(0,r.kt)("p",null,'N\xe5r man skal hente data fra et annet system, kan man gj\xf8re dette enten ved \xe5 eksplisitt sp\xf8rre systemet ("pull"), eller ved \xe5 \xe5pne for at systemet kan sende inn data selv ("push").'),(0,r.kt)("h3",{id:"pull-pipelines"},"Pull-pipelines"),(0,r.kt)("p",null,'Integrasjoner som henter data ved "pulling" kjennetegnes ved f\xf8lgende:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Kildesystemet m\xe5 ha et endepunkt som er tilgjengelig fra internett",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Det kan f.eks. v\xe6re et REST API eller en database, og kan godt v\xe6re passordbeskyttet eller sikret p\xe5 annen m\xe5te"),(0,r.kt)("li",{parentName:"ul"},"Unntaksmessig kan det settes opp VPN-kobling fra interne SVV-systemer til GCP"))),(0,r.kt)("li",{parentName:"ul"},"Integrasjonen er ansvarlig for oppdateringsfrekvens og validering av data"),(0,r.kt)("li",{parentName:"ul"},"Kildesystemet trenger ikke kjenne til integrasjonen eller Saga"),(0,r.kt)("li",{parentName:"ul"},"Henting av data skjer periodisk, f.eks. via en Cloud Scheduler")),(0,r.kt)("h4",{id:"eksempel"},"Eksempel"),(0,r.kt)("p",null,'Her er et eksempel p\xe5 en "pull"-pipeline som bruker Cloud Functions, GCS og BigQuery, for et tenkt "Weather" API:'),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Example poller pipeline",src:a(3799).Z,width:"982",height:"271"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"En Cloud Scheduler trigger hver time og kaller function'en ",(0,r.kt)("inlineCode",{parentName:"li"},"weather-poller")," over HTTP"),(0,r.kt)("li",{parentName:"ol"},"Polleren gj\xf8r et REST-kall mot API og henter v\xe6rdata i JSON-format"),(0,r.kt)("li",{parentName:"ol"},"Polleren lagrer JSON uendret i en GCS-b\xf8tte ",(0,r.kt)("inlineCode",{parentName:"li"},"weather-ingest")),(0,r.kt)("li",{parentName:"ol"},"En Cloud Function ",(0,r.kt)("inlineCode",{parentName:"li"},"weather-standardizer")," lytter p\xe5 nye filer i ",(0,r.kt)("inlineCode",{parentName:"li"},"weather-ingest"),"-b\xf8tta, leser disse og konverterer dem til et standardisert format"),(0,r.kt)("li",{parentName:"ol"},"Standardizeren streamer data til en tabell ",(0,r.kt)("inlineCode",{parentName:"li"},"internal.weather")),(0,r.kt)("li",{parentName:"ol"},"Et view ",(0,r.kt)("inlineCode",{parentName:"li"},"standardized.weather")," dedupliserer data fra ",(0,r.kt)("inlineCode",{parentName:"li"},"internal.weather")," basert p\xe5 et definert unikhetskriterie (f.eks. m\xe5lestasjon og tidspunkt)")),(0,r.kt)("p",null,"Et annet eksempel finnes i ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/svvsaga/saga-team-template"},'"saga-team-template"-repoet'),", sammen med eksempler p\xe5 bruk av Terraform for versjonert infrastruktur, og GitHub Actions for automatisk release og deploy."),(0,r.kt)("h3",{id:"push-pipelines"},"Push-pipelines"),(0,r.kt)("p",null,'Integrasjoner som henter data ved "pushing" kjennetegnes ved f\xf8lgende:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Integrasjonen m\xe5 tilgjengeliggj\xf8re et endepunkt som kildesystemet kan sende data til",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Dette kan v\xe6re f.eks. en Pub/Sub-topic, en GCS-bucket eller en BigQuery-tabell"))),(0,r.kt)("li",{parentName:"ul"},"Kildesystemet styrer oppdateringsfrekvens; kan v\xe6re periodisk, kontinuerlig eller sporadisk"),(0,r.kt)("li",{parentName:"ul"},"Kildesystemet m\xe5 kjenne til Saga og autentisere seg mot GCP, typisk via en Service Account"),(0,r.kt)("li",{parentName:"ul"},"Kildesystemet trenger ikke v\xe6re eksponert p\xe5 internett, men m\xe5 kunne gj\xf8re kall mot GCP")),(0,r.kt)("h4",{id:"eksempel-1"},"Eksempel"),(0,r.kt)("p",null,'Her er et eksempel p\xe5 en veldig enkel "push"-pipeline der et kildesystem skriver direkte til BigQuery:'),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Example BigQuery push pipeline",src:a(5448).Z,width:"681",height:"201"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Kildesystemet skriver kontinuerlig data til BigQuery-tabellen ",(0,r.kt)("inlineCode",{parentName:"li"},"raw.trafficdata")),(0,r.kt)("li",{parentName:"ol"},"En ",(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/scheduling-queries"},"scheduled query")," transformerer og merger data i standardisert form inn i tabellen ",(0,r.kt)("inlineCode",{parentName:"li"},"standardized.trafficdata"))),(0,r.kt)("p",null,'Merk at selv om denne arkitekturen ved f\xf8rste \xf8yekast ser mye enklere ut enn "pull"-pipelinen, s\xe5 er mye av kompleksiteten og ansvaret flyttet til kildesystemet; det blir opp til dette \xe5 s\xf8rge for at data blir sendt p\xe5 riktig tid og i riktig format.'))}k.isMDXComponent=!0},5448:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/example_pipeline_bigquery.drawio-c6ced22e2a940dee97faf85d54ef74f3.svg"},3799:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/example_pipeline_poller.drawio-e25eb7d5fc90f679d80fc4bcd6445b7f.svg"}}]);